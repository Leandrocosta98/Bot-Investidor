<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - Bot Investidor</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>ðŸ“Š Ativos Monitorados</h1>
        <button class="btn-refresh" onclick="carregarDados()">ðŸ”„ Atualizar Painel</button>
        
        <table id="tabela-acoes">
            <thead>
                <tr>
                    <th>Ticker</th>
                    <th>PreÃ§o Base</th>
                    <th>Alvo de Queda</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="corpo-tabela">
                </tbody>
        </table>
    </div>

    <script>
        async function carregarDados() {
            const tbody = document.getElementById('corpo-tabela');
            tbody.innerHTML = "<tr><td colspan='4'>Carregando ativos...</td></tr>";

            try {
                const resposta = await fetch('/api/dados');
                const dados = await resposta.json();

                tbody.innerHTML = "";

                if (dados.length === 0) {
                    tbody.innerHTML = "<tr><td colspan='4'>Nenhum ativo sendo monitorado no momento.</td></tr>";
                    return;
                }

                dados.forEach(acao => {
                    const precoAlvo = acao.precoBase * (1 - acao.limiteQueda);
                    const row = `
                        <tr>
                            <td><strong>${acao.ticker}</strong></td>
                            <td>R$ ${acao.precoBase.toFixed(2)}</td>
                            <td>R$ ${precoAlvo.toFixed(2)} (-${acao.limiteQueda * 100}%)</td>
                            <td class="status-up">Ativo ðŸ“¡</td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
            } catch (error) {
                tbody.innerHTML = "<tr><td colspan='4'>Erro ao carregar dados.</td></tr>";
            }
        }

        // Carrega os dados assim que a pÃ¡gina abre
        carregarDados();
        // Atualiza automaticamente a cada 30 segundos
        setInterval(carregarDados, 30000);
    </script>
</body>
</html>